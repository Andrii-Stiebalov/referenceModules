{"ast":null,"code":"import Hints from \"../Components/Hints.vue\";\nimport Driving from \"../Components/Licences/Driving.vue\";\nimport Gun from \"../Components/Licences/Gun.vue\";\nimport Lawyers from \"../Components/Licences/Lawyers.vue\";\nimport Fishing from \"../Components/Licences/Fishing.vue\";\nimport Medical from \"../Components/Licences/Medical.vue\";\nimport Military from \"../Components/Licences/Military.vue\";\nimport Hunt from \"../Components/Licences/Hunt.vue\";\nconst Components = {\n  army: Military,\n  fish: Fishing,\n  drive: Driving,\n  gun: Gun,\n  med: Medical,\n  advocate: Lawyers,\n  hunt: Hunt\n};\nconst LicencesList = [{\n  id: \"army\",\n  name: \"Военный билет\"\n}, {\n  id: \"fish\",\n  name: \"Лицензия на рыболовство\"\n}, {\n  id: \"drive\",\n  name: \"Лицензия на вождение\"\n}, {\n  id: \"gun\",\n  name: \"Лицензия на оружие\"\n}, {\n  id: \"med\",\n  name: \"Медицинская карта\"\n}, {\n  id: \"advocate\",\n  name: \"Лицензия адвоката\"\n}, {\n  id: \"hunt\",\n  name: \"Лицензия на охоту\"\n}];\nexport default {\n  components: {\n    Hints,\n    ...Object.values(Components)\n  },\n  data() {\n    return {\n      hints: [{\n        keys: [\"Q\", \"E\"],\n        title: \"Выбрать документ\"\n      }, {\n        keys: [\"Esc\"],\n        title: \"Закрыть\"\n      }],\n      data: null,\n      licenceList: [],\n      activeLicence: null\n    };\n  },\n  computed: {\n    getComponent() {\n      return this.activeLicence ? Components[this.activeLicence.id] || null : null;\n    },\n    getComponentData() {\n      return this.activeLicence ? this.data[this.activeLicence.id] : null;\n    }\n  },\n  methods: {\n    onKeyUp(e) {\n      if (e.keyCode === 27 && !window.isModalShow) this.$router.push(\"/\");\n    },\n    onChangeLicence(multiplier) {\n      if (this.licenceList.length) {\n        let currentIndex = this.licenceList.indexOf(this.activeLicence);\n        let nextIndex = this.licenceList[currentIndex + multiplier] ? currentIndex + multiplier : multiplier == 1 ? 0 : this.licenceList.length - 1;\n        this.setActiveLicence(this.licenceList[nextIndex]);\n      }\n    },\n    onKeyDown(e) {\n      if (e.keyCode == 81 || e.keyCode == 69) {\n        let multiplier = e.keyCode == 81 ? -1 : 1;\n        this.onChangeLicence(multiplier);\n      }\n    },\n    isLicenceActive(licence) {\n      return this.activeLicence == licence;\n    },\n    setActiveLicence(licence) {\n      if (!this.isLicenceActive(licence)) this.activeLicence = licence;\n    },\n    setData(payload) {\n      if (payload && typeof payload == \"object\") {\n        const {\n          cName,\n          cSurname\n        } = (payload.name || \"\").split(\"_\").reduce((acc, cur, idx) => {\n          acc[idx ? \"cSurname\" : \"cName\"] = cur;\n          return acc;\n        }, {});\n        const cFullname = [cName, cSurname].join(\" \");\n        Object.keys(payload).filter(prop => typeof payload[prop] === \"object\").forEach(prop => {\n          let updatedData = {};\n          if (prop == \"drive\") updatedData = {\n            cName,\n            cSurname\n          };else {\n            const issuedBy = (payload[prop].issuedBy || \"\").split(\"/\").join(\" \");\n            if (prop != \"med\") {\n              const dates = [\"valided\", \"issued\"].reduce((acc, cur) => {\n                if (payload[prop][cur]) {\n                  let date = new Date((payload[prop][cur] || \"\").split(\"/\").reverse().join(\",\") || false);\n                  let [month, day, year] = date.toLocaleDateString(\"en-US\", {\n                    day: \"numeric\",\n                    month: \"long\",\n                    year: \"numeric\"\n                  }).split(\" \");\n                  acc[cur] = `${cur == \"issued\" ? this.$t(\"Выдано\") : this.$t(\"Действительно до\")} «<span>${day}</span>» <span>${this.$t(month)}</span> <span>${year}</span> ${this.$t(\"г.\")}`;\n                }\n                return acc;\n              }, {});\n              updatedData = {\n                ...dates,\n                cFullname,\n                issuedBy\n              };\n            } else {\n              updatedData = {\n                issuedBy,\n                cFullname\n              };\n            }\n          }\n          Object.assign(payload[prop], updatedData);\n        });\n        this.data = payload;\n        this.licenceList = LicencesList.filter(el => this.data[el.id] !== undefined);\n        if (this.licenceList.length) this.setActiveLicence(this.licenceList[0]);\n      }\n    }\n  },\n  created() {\n    window.addEventListener(\"keyup\", this.onKeyUp);\n    window.addEventListener(\"keydown\", this.onKeyDown);\n    this.$onClient(\"W:DocumentsLicences:SetData\", this.setData);\n    this.$callClient(\"C:DocumentsLicences:Ready\");\n  },\n  beforeUnmount() {\n    window.removeEventListener(\"keyup\", this.onKeyUp);\n    window.removeEventListener(\"keydown\", this.onKeyDown);\n    this.$offClient(\"W:DocumentsLicences:SetData\", this.setData);\n    this.$callClient(\"C:DocumentsLicences:Destroyed\");\n  }\n};","map":null,"metadata":{},"sourceType":"module"}