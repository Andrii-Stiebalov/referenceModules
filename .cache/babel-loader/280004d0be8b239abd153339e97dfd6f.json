{"ast":null,"code":"import { mapGetters } from \"vuex\";\nimport api from \"./mixins/api.js\";\nimport requestGetBuilder from \"./functions/requestGetBuilder.js\";\nimport IconClock1 from \"./assets/icons/clock-1.vue\";\nimport IconCalendar1 from \"./assets/icons/calendar-1.vue\";\nimport IconArrow2 from \"./assets/icons/arrow-2.vue\";\nexport default {\n  components: {\n    IconClock1,\n    IconCalendar1,\n    IconArrow2\n  },\n  mixins: [api],\n  data() {\n    return {\n      newsList: []\n    };\n  },\n  computed: {\n    ...mapGetters(\"global\", [\"getCdnResolver\"]),\n    ...mapGetters(\"authentication\", [\"getNews\"])\n  },\n  methods: {\n    getNewsRequest(timeout) {\n      this.newsTimeout = setTimeout(() => {\n        requestGetBuilder([{\n          key: \"limit\",\n          value: this.getNews.limit\n        }]).then(query => {\n          this.APIgetNewsRequest(query).then(data => {\n            if (data.status) {\n              this.newsList.push(...data.news.reduce((a, b) => {\n                if (!this.newsList.find(a => a.id === b.id)) {\n                  b.load = false;\n                  a.push(b);\n                }\n                return a;\n              }, []));\n              this.getNews.content = this.newsList;\n            }\n          }).catch(() => {\n            this.$Notification.create({\n              type: \"error\",\n              layout: \"compact-bottom__right\",\n              theme: \"compact\",\n              time: 5000,\n              text: `\n                                    <div class=\"notification-text__item\">\n                                        <div class=\"notification-text__item-title\">\n                                            <span>${this.$t(\"Ошибка\")}</span>\n                                        </div>\n                                        <div class=\"notification-text__item-subtitle\">\n                                            <span>${this.$t(\"Время ожидание от сервера вышло, попробуйте позже.\")}</span>\n                                        </div>\n                                    </div>\n                                    <div class=\"notification-text__item\">\n                                        <div class=\"notification-text__item-icon\">\n                                            <span class=\"icon-error\"></span>\n                                        </div>\n                                    </div>\n                                `,\n              progressBar: false\n            });\n            this.$router.push(\"/authentication/login\");\n          });\n        });\n      }, timeout);\n    },\n    getNewsPreviewLoadStatus(id) {\n      let findNews = this.newsList.find(a => a.id === id);\n      if (findNews) {\n        let image = document.createElement(\"img\");\n        image.src = `${this.getCdnResolver.cdnLink}/news/${findNews.url}`;\n        image.onload = () => {\n          findNews.load = true;\n        };\n      }\n      return findNews.load;\n    },\n    getNewsPreview(url) {\n      return `${this.getCdnResolver.cdnLink}/news/${url}`;\n    },\n    newsListScrollInit(el) {\n      el.addEventListener(\"scroll\", this.newsListScrollHandler);\n    },\n    newsListScrollHandler(e) {\n      this.scrollTimeout && clearTimeout(this.scrollTimeout);\n      this.scrollTimeout = setTimeout(() => {\n        this.getNews.scrollTop = e.target.scrollTop;\n        if (e.target.scrollHeight - e.target.scrollTop === e.target.clientHeight) {\n          this.getNews.limit += 4; // In config\n          this.getNewsRequest();\n        }\n      }, 250);\n    },\n    newsListScrollToHandler() {\n      setTimeout(() => {\n        if (this.getNews.scrollTop) {\n          this.$refs.ulAuthenticationNewsContentList.scroll({\n            top: this.getNews.scrollTop,\n            behavior: \"smooth\"\n          });\n        }\n      }, 500);\n    },\n    selectNews(id) {\n      this.$refs.ulAuthenticationNewsContentList.removeEventListener(\"scroll\", this.newsListScrollHandler);\n      this.getNews.selected = id;\n      this.$router.push(\"/authentication/news/view\");\n    },\n    getTime(date) {\n      return new Date(date).toLocaleString(\"uk-UA\", {\n        timezone: \"Europe/Kiev\",\n        hour: \"2-digit\",\n        minute: \"2-digit\"\n      });\n    },\n    getDate(date) {\n      return new Date(date).toLocaleString(\"uk-UA\", {\n        timezone: \"Europe/Kiev\",\n        day: \"2-digit\",\n        month: \"2-digit\",\n        year: \"2-digit\"\n      });\n    }\n  },\n  mounted() {\n    if (this.getNews.selected) {\n      return this.$router.push(\"/authentication/news/view\");\n    }\n    if (this.getNews.content.length) {\n      this.newsList = this.getNews.content;\n      return this.newsListScrollToHandler();\n    }\n    this.getNewsRequest(2500);\n  },\n  unmounted() {\n    clearTimeout(this.newsTimeout);\n    if (!this.$route.path.startsWith(\"/authentication/news\")) {\n      this.getNews.limit = 6; // In config\n      this.getNews.content = [];\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}