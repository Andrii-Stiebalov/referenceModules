{"ast":null,"code":"import { Howl } from \"howler\";\nexport default {\n  data() {\n    return {\n      figureList: [],\n      currentFigure: null,\n      transform: 65,\n      speed: 0.075,\n      figureListInterval: null,\n      IsRight: null,\n      showColor: false,\n      countOfCurrentFigure: 0,\n      maxCountOfCurrentFigure: 3,\n      trueCount: 0,\n      bindArrow: {\n        37: \"←\",\n        38: \"↑\",\n        39: \"→\",\n        40: \"↓\"\n      },\n      sendInterval: null,\n      colorTranslate: {\n        orange: \"Желтый\",\n        red: \"Красный\",\n        purple: \"Фиолетовый\",\n        green: \"Зеленный\"\n      },\n      width: 13.5,\n      colorBind: {\n        orange: \"#FFCC4D\",\n        red: \"#F53\",\n        purple: \"#A30EFF\",\n        green: \"#34C924\"\n      },\n      figureBind: {\n        rectangle: \"Квадрат\",\n        circle: \"Круг\",\n        triangle: \"Треугольник\",\n        star: \"Звезда\"\n      }\n    };\n  },\n  methods: {\n    getImgPath(name) {\n      return require(`../Assets/figures/${name}.png`);\n    },\n    getRandomColor() {\n      const randomIndex = Math.floor(Math.random() * 4);\n      return Object.values(this.colorBind)[randomIndex];\n    },\n    getCharFromKeyCode(keyCode) {\n      return String.fromCharCode(keyCode);\n    },\n    checkFigure(keycode) {\n      const leaveLength = (this.transform - 65) * -1;\n      const index = Math.floor(leaveLength / this.width);\n      const selectFigure = this.figureList[index - 2];\n      this.showColor = true;\n      if (this.timeout) {\n        clearTimeout(this.timeout);\n      }\n      this.timeout = setTimeout(() => {\n        this.showColor = false;\n      }, 300);\n      if (!selectFigure) {\n        // this.$callClient(\"C:TapTapMiniGame\", false);\n        return;\n      }\n      this.setElemAnim();\n      if (selectFigure.key === keycode) {\n        if (leaveLength % this.width >= 2 && leaveLength % this.width <= 8) {\n          this.IsRight = true;\n          this.trueCount++;\n          // this.$callClient(\"C:Workbench:MiniGame\", true);\n          this.showColor = true;\n          this.playSound();\n        } else {\n          // this.$callClient(\"C:Workbench:MiniGame\", false);\n          this.IsRight = false;\n          this.playSound(true);\n        }\n      } else {\n        // this.$callClient(\"C:Workbench:MiniGame\", false);\n        this.IsRight = false;\n        this.playSound(true);\n      }\n    },\n    playSound(isFail) {\n      const path = !isFail ? `../Assets/anvil.wav` : `../Assets/anvil-fail.wav`;\n      let sound = new Howl({\n        src: require(isFail ? `../Assets/anvil-fail.wav` : `../Assets/anvil.wav`),\n        volume: 0.5,\n        rate: Math.random() - 0.3 + 0.75\n      });\n      sound.play();\n    },\n    setElemAnim() {\n      const tapItem = document.getElementById(\"TapTapMiniGame_figures-enter-section\");\n      tapItem.style.transform = \"scale(0.9)\";\n      setTimeout(() => tapItem.style.transform = \"scale(1)\", 100);\n    },\n    setAnim() {\n      const listElem = document.getElementsByClassName(\"TapTapMiniGame_figuresList-section\");\n      let lastTransform = Object.freeze(this.transform);\n      const width = this.width;\n      this.figureListInterval = setInterval(() => {\n        const countOfItemLive = Math.floor((lastTransform - this.transform) / width);\n        listElem[0].style.transform = `translateX(${this.transform -= this.speed}rem)`;\n        if (countOfItemLive && !(countOfItemLive % 8)) {\n          lastTransform = this.transform;\n          this.setRandomFigureList();\n        }\n      });\n    },\n    getFigureStyle(figure) {\n      const app = this;\n      const style = {\n        backgroundColor: app.colorBind[figure.color],\n        maskImage: `url(${app.getImgPath(figure.figure)})`\n      };\n      return style;\n    },\n    setRandomFigureList() {\n      const lastLength = this.figureList.length;\n      for (let i = 0; i < 10; i++) {\n        const key = this.generateRandomKeyCode();\n        const figureItem = {\n          key\n        };\n        this.figureList.push(figureItem);\n      }\n      const currentLength = this.figureList.length;\n      const index = Math.floor(Math.random() * (currentLength - lastLength)) + lastLength;\n      this.countOfCurrentFigure++;\n    },\n    setRandomPositionBtn() {\n      const btns = document.querySelectorAll(\".TapTapMiniGame-fall-btn\");\n      const positionList = [];\n      btns.forEach(btn => {\n        let left;\n        do {\n          left = Math.random() * 100;\n        } while (this.chekDef(left, positionList));\n        positionList.push(left);\n        btn.style.left = left + \"%\";\n        btn.style.transform = `translateY(${Math.random() * 200}%)`;\n      });\n    },\n    chekDef(position, positionList) {\n      let result = false;\n      positionList.forEach(posit => {\n        if (posit - 5 < position && posit + 5 > position) {\n          result = true;\n        }\n      });\n      return result;\n    },\n    generateRandomKeyCode() {\n      const minKeyCode = 37;\n      const maxKeyCode = 40;\n      return Math.floor(Math.random() * (maxKeyCode - minKeyCode + 1)) + minKeyCode;\n    },\n    setRandomFigure() {\n      const colors = Object.keys(this.colorBind);\n      const figures = Object.keys(this.figureBind);\n      const color = colors[Math.floor(Math.random() * 4)];\n      const figure = figures[Math.floor(Math.random() * 4)];\n      this.currentFigure = {\n        color,\n        figure\n      };\n    },\n    setBtnList() {\n      for (let i = 0; i <= 3; i++) {\n        let isApproved = false;\n        while (!isApproved) {\n          const rndmKey = this.generateRandomKeyCode();\n          if (!this.btnList.includes(rndmKey)) {\n            isApproved = true;\n            this.btnList.push(rndmKey);\n          }\n        }\n      }\n    },\n    setData(data) {\n      this.speed = data.speed;\n    },\n    hendleTap(e) {\n      this.checkFigure(e.keyCode);\n    }\n  },\n  mounted() {\n    this.setRandomFigure();\n    this.setRandomFigureList();\n    this.setAnim();\n    window.addEventListener(\"keydown\", this.hendleTap);\n    this.$offClient(\"C:TapTapMiniGame:SetData\", this.setData);\n    this.$callClient(\"C:TapTapMiniGame:Ready\");\n    this.sendInterval = setInterval(() => {\n      this.$callClient(\"C:Workbench:MiniGame:TrueCount\", this.trueCount);\n      this.trueCount = 0;\n    }, 25000);\n  },\n  beforeUnmount() {\n    window.removeEventListener(\"keydown\", this.handelTap);\n    this.$offClient(\"C:TapTapMiniGame:SetData\", this.setData);\n    this.$callClient(\"C:TapTapMiniGame:Ready\");\n    clearInterval(this.sendInterva);\n    clearInterval(this.figureListInterval);\n  }\n};","map":null,"metadata":{},"sourceType":"module"}